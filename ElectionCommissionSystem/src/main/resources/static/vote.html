<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Vote ‚Ä¢ Election Commission</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root{--ink:#0f172a;--blue:#2b7bff;--bg:#f5f8ff;--pill:#eef3ff}
  *{box-sizing:border-box} body{font-family:Segoe UI,Arial;background:var(--bg);margin:0;color:var(--ink);text-align:center}
  .nav{display:flex;gap:10px;align-items:center;justify-content:space-between;padding:12px 16px;background:#fff;box-shadow:0 2px 12px rgba(0,0,0,.06);position:sticky;top:0;z-index:10}
  .brand{font-weight:700} .links a{color:#0b63ff;text-decoration:none;margin:0 6px;padding:8px 12px;background:var(--pill);border-radius:10px}
  .wrap{padding:24px}
  .card{background:#fff;border-radius:16px;padding:22px;display:inline-block;min-width:360px;box-shadow:0 10px 22px rgba(0,0,0,.06);margin:12px}
  h1{margin:12px 0 18px}
  label{display:block;margin:12px 0 6px;color:#555}
  input{width:100%;padding:12px;border:1px solid #dfe6ff;border-radius:12px}
  button{margin-top:14px;background:#28a745;color:#fff;border:none;padding:12px 16px;border-radius:12px;cursor:pointer}
  button:hover{opacity:.95}
  .msg{margin-top:10px;font-weight:600} .ok{color:#0a8a2a} .bad{color:#c0122a}
  table{margin:20px auto;border-collapse:collapse;width:90%;max-width:900px;background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 6px 18px rgba(0,0,0,.06)}
  th,td{padding:10px;border-bottom:1px solid #eee;text-align:center}
  th{background:#f0f5ff;color:#222}
  tr:hover{background:#f8faff}
</style>
</head>
<body>
  <div class="nav">
    <div class="brand">üó≥Ô∏è Election Commission</div>
    <div class="links">
      <a href="admin.html">Admin</a>
      <a href="vote.html">Vote</a>
      <a href="results.html">Results</a>
      <a href="map.html">Map</a>
    </div>
  </div>

  <div class="wrap">
    <h1>Cast Your Vote</h1>

    <!-- Candidate List -->
    <div class="card" style="width:90%;max-width:950px">
      <h3>List of Candidates</h3>
      <table>
        <thead>
          <tr>
            <th>Candidate ID</th>
            <th>Name</th>
            <th>Party</th>
            <th>Constituency</th>
          </tr>
        </thead>
        <tbody id="candidateTable"></tbody>
      </table>
    </div>

    <!-- Voting Section -->
    <div class="card">
      <h3>Enter Your Details</h3>
      <label>Voter ID</label><input id="voterId" placeholder="e.g. V101">
      <label>Candidate ID</label><input id="candidateId" placeholder="e.g. C101">
      <button onclick="castVote()">Cast Vote</button>
      <div id="msg" class="msg"></div>
    </div>
  </div>

<script>
async function loadCandidates(){
  try{
    const res = await fetch('/api/admin/candidates');
    const data = await res.json();
    const tbody = document.getElementById('candidateTable');
    tbody.innerHTML = '';
    if(!data || data.length === 0){
      tbody.innerHTML = '<tr><td colspan="4">No candidates registered yet.</td></tr>'; return;
    }
    data.forEach(c => {
      tbody.innerHTML += `
        <tr>
          <td>${c.candidateId}</td>
          <td>${c.name}</td>
          <td>${c.party}</td>
          <td>${c.constituency}</td>
        </tr>`;
    });
  }catch(e){ console.error('Error loading candidates:', e); }
}

async function castVote(){
  const voterId = val('voterId'), candidateId = val('candidateId');
  if(!voterId || !candidateId) return show('Please enter both IDs','bad');

  const r = await fetch(`/api/vote/${encodeURIComponent(voterId)}/${encodeURIComponent(candidateId)}`, { method:'POST' });
  const t = await r.text();
  show(t, r.ok ? 'ok' : 'bad');
}
function val(id){return document.getElementById(id).value.trim();}
function show(m,c){ const el=document.getElementById('msg'); el.textContent=m; el.className='msg '+c; }

loadCandidates();
</script>
</body>
</html>
