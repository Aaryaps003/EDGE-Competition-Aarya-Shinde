<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel ‚Ä¢ Election Commission</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root{--ink:#0f172a;--blue:#2b7bff;--bg:#f5f8ff;--pill:#eef3ff}
  *{box-sizing:border-box} body{font-family:Segoe UI,Arial;background:var(--bg);margin:0;color:var(--ink)}
  .nav{display:flex;gap:10px;align-items:center;justify-content:space-between;padding:12px 16px;background:#fff;box-shadow:0 2px 12px rgba(0,0,0,.06);position:sticky;top:0;z-index:10}
  .brand{font-weight:700} .links a{color:#0b63ff;text-decoration:none;margin:0 6px;padding:8px 12px;background:var(--pill);border-radius:10px}
  .logout{background:#c0122a;color:#fff;border:none;padding:8px 12px;border-radius:10px;cursor:pointer}
  .wrap{max-width:1100px;margin:20px auto;padding:0 16px}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:16px}
  .card{background:#fff;border-radius:14px;padding:20px;box-shadow:0 8px 20px rgba(0,0,0,.08)}
  input{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:1px solid #dfe6ff}
  button.primary{background:var(--blue);color:#fff;border:none;padding:10px 16px;border-radius:10px;cursor:pointer}
  .msg{margin-top:10px;font-weight:600}.ok{color:#0a8a2a}.bad{color:#c0122a}
  .download{margin-top:16px;text-align:center}
</style>
</head>
<body>
  <div class="nav">
    <div class="brand">üó≥Ô∏è Election Commission</div>
    <div class="links">
      <a href="admin.html">Admin</a>
      <a href="vote.html">Vote</a>
      <a href="results.html">Results</a>
      <a href="map.html">Map</a>
    </div>
    <button class="logout" onclick="logout()">Logout</button>
  </div>

  <div class="wrap">
    <div class="grid">
      <div class="card">
        <h2>Register Voter</h2>
        <input id="voterId" placeholder="Voter ID (unique)">
        <input id="voterName" placeholder="Voter Name">
        <input id="voterAge" type="number" placeholder="Age">
        <input id="voterConst" placeholder="Constituency">
        <button class="primary" onclick="addVoter()">Add Voter</button>
        <div id="voterMsg" class="msg"></div>
      </div>

      <div class="card">
        <h2>Register Candidate</h2>
        <input id="candId" placeholder="Candidate ID (unique)">
        <input id="candName" placeholder="Candidate Name">
        <input id="candParty" placeholder="Party Name">
        <input id="candConst" placeholder="Constituency">
        <button class="primary" onclick="addCandidate()">Add Candidate</button>
        <div id="candMsg" class="msg"></div>
      </div>
    </div>

    <div class="card download">
      <button class="primary" onclick="downloadXML()">üßæ Download Results XML</button>
    </div>
  </div>

<script>
// üîí Auth guard
if(localStorage.getItem("isAdminLogged") !== "true"){
  alert("Unauthorized! Please login first.");
  window.location.href = "login.html";
}

function logout(){
  localStorage.removeItem("isAdminLogged");
  alert("Logged out successfully!");
  window.location.href = "login.html";
}

async function addVoter(){
  const v = {
    voterId: val('voterId'), name: val('voterName'),
    age: parseInt(val('voterAge')||'0'), constituency: val('voterConst'),
    hasVoted: false
  };
  if(!v.voterId || !v.name || !v.constituency || !v.age)
    return show('voterMsg','Fill all fields','bad');
  if(v.age < 18) return show('voterMsg','Voter must be 18+','bad');

  const res = await fetch('/api/admin/voter', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(v) });
  show('voterMsg', await res.text(), res.ok?'ok':'bad');
}

async function addCandidate(){
  const c = {
    candidateId: val('candId'), name: val('candName'),
    party: val('candParty'), constituency: val('candConst'),
    voteCount: 0
  };
  if(!c.candidateId || !c.name || !c.party || !c.constituency)
    return show('candMsg','Fill all fields','bad');

  const res = await fetch('/api/admin/candidate', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(c) });
  show('candMsg', await res.text(), res.ok?'ok':'bad');
}

function val(id){return document.getElementById(id).value.trim();}
function show(id,msg,ok){const el=document.getElementById(id); el.textContent=msg; el.className='msg '+(ok?'ok':'bad');}

function downloadXML() {
  fetch('results.xml')
    .then(res => { if (!res.ok) throw new Error("File not found yet. Cast a vote first!"); return res.blob(); })
    .then(blob => { const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href=url; a.download='Election_Results.xml'; a.click(); URL.revokeObjectURL(url); })
    .catch(err => alert("‚ö†Ô∏è " + err.message));
}
</script>
</body>
</html>
